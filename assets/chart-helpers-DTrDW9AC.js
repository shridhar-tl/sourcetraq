import{k as E,W as D,e as B,P as O}from"../index.DzQsZOrm.js";import{t as n,O as F}from"./chart-options-DMkJgpgA.js";function Q(e,d){const p=Object.keys(e||{});return p.length?p.filter(l=>e[l].prList.length).map(l=>{const r=e[l],i=d==null?void 0:d[l],A=(r==null?void 0:r.commits)??[],u=(i==null?void 0:i.commits)??[],o=(r==null?void 0:r.prList)??[],b=(i==null?void 0:i.prList)??[],k=A.length,m=u.length,R=k-m,x=m>0?R/m*100:100,P=o.length,t=b.length,h=P-t,y=t>0?h/t*100:100,v=o.filter(s=>s.state==="MERGED").length,w=o.filter(s=>s.state==="DECLINED").length,T=b.filter(s=>s.state==="DECLINED").length,a=w-T,c=T>0?a/T*100:100,C=[],I=[],Z=[],j=[],U=[],Y=[],M=[],G=[];o.forEach(s=>{if(s.closedDate){const f=s.createdDate instanceof Date?s.createdDate:new Date(s.createdDate),N=s.closedDate instanceof Date?s.closedDate:new Date(s.closedDate);C.push(E(N,f))}const{firstCommitDate:H,createdDate:J,firstActivityDate:_,approveDate:W}=s.properties.cycleTime;if(I.push(E(new Date(J),new Date(H))),s.state==="MERGED"){const f=s.createdDate instanceof Date?s.createdDate:new Date(s.createdDate),N=s.closedDate instanceof Date?s.closedDate:new Date(s.closedDate);Z.push(E(N,f))}if(W){const f=s.createdDate instanceof Date?s.createdDate:new Date(s.createdDate);j.push(E(new Date(W),f))}if(_){const f=s.createdDate instanceof Date?s.createdDate:new Date(s.createdDate);G.push(E(new Date(_),f))}const q=s.reviewers??[];U.push(q.length),Y.push(q.filter(f=>f.approved===!0).length),M.push(s.properties.commentCount)});const z=b.map(s=>s.properties.commentCount)??[],L=D(z);return{user:r.user,totalCommits:k,commitDelta:{diff:n(R),percent:n(x)},totalPRs:P,prDelta:{diff:n(h),percent:n(y)},mergedPRs:v,declinedPRs:w,declinedDelta:{diff:n(a),percent:n(c)},avgPROpenDays:n(D(C)),avgDaysFirstCommitToPR:n(D(I)),avgDaysPRToMerge:n(D(Z)),avgDaysPRToApproval:n(D(j)),avgReviewers:n(D(U)),avgReviewersApproved:n(D(Y)),avgComments:n(D(M)),commentDelta:{diff:n(D(M)-L),percent:L>0?n((D(M)-L)/L*100):100},avgDaysFirstActivity:n(D(G))}}):[]}function K(e){if(!e||e.length===0)return{data:{labels:[],datasets:[]},options:F()};e=B(e.filter(o=>o.totalCommits),o=>o.totalCommits).slice(0,15);const d=e.map(o=>o.totalCommits),p=e.map(o=>o.user),g=p.map(o=>o.displayName||o.name),l=O(d)||15,r=d.length<5?80:void 0,A={labels:g,datasets:[{label:"Commits",data:d,backgroundColor:"#4CAF50",type:"bar",stack:"stack1",borderRadius:2,barThickness:r,yAxisID:"y"}]},u={...F(),scales:{x:{stacked:!0,ticks:{display:!1},afterFit:o=>o.height=50},y:{stacked:!0,beginAtZero:!0,min:0,max:l}},plugins:{legend:{display:!1}},users:p};return{data:A,options:u}}function S(e,d,p,g,l){if(!e||e.length===0)return{data:{labels:[],datasets:[]},options:F()};e=B(e.filter(a=>a.totalPRs),a=>a.totalPRs).slice(0,l);const r=e.map(a=>a.mergedPR),i=e.map(a=>a.openPR),A=e.map(a=>a.declinedPR),u=e.map(a=>a.unknownPR),o=e.map(a=>a.user),b=o.map(a=>a.displayName||a.name),k=u.some(a=>a>0),m=Q(d,p).reduce((a,c)=>(a[c.user.name]=c,a),{}),R=e.map(a=>{var c;return((c=m[a.user.name])==null?void 0:c.avgDaysPRToMerge)??0}),x=e.map(a=>{var c;return((c=m[a.user.name])==null?void 0:c.avgPROpenDays)??0}),P=e.map(a=>{var c;return((c=m[a.user.name])==null?void 0:c.avgDaysPRToApproval)??0}),t=O(e.map(a=>a.totalPRs))||15,h=O(x)||15,y=o.length<5?80:void 0,v=[{label:"Merged",data:r,backgroundColor:"#4CAF50",type:"bar",stack:"stack1",borderRadius:2,barThickness:y,yAxisID:"y"},{label:"Open",data:i,backgroundColor:"#FFC107",type:"bar",stack:"stack1",borderRadius:2,barThickness:y,yAxisID:"y"},{label:"Declined",data:A,backgroundColor:"#F44336",type:"bar",stack:"stack1",borderRadius:2,barThickness:y,yAxisID:"y"},k&&{label:"Unknown",data:u,backgroundColor:"#9E9E9E",type:"bar",stack:"stack1",borderRadius:2,barThickness:y,yAxisID:"y"},{label:"Age",data:x,borderColor:"#FF9800",backgroundColor:"rgba(255,152,0,0.5)",type:"line",fill:!1,yAxisID:"y1"},{label:"Approval Days",data:P,borderColor:"#F44336",backgroundColor:"rgba(244,67,54,0.5)",type:"line",fill:!1,yAxisID:"y1"},{label:"Cycle Time",data:R,borderColor:"#2196F3",backgroundColor:"rgba(33,150,243,0.5)",type:"line",fill:!1,yAxisID:"y1"}].filter(Boolean),w={labels:b,datasets:v},T={...F(),onClick:(a,c)=>{var I;const C=(I=c==null?void 0:c[0])==null?void 0:I.index;C>=0&&(g==null||g(o[C]))},users:o,scales:{x:{stacked:!0,ticks:{display:!1},afterFit:a=>a.height=50},y:{stacked:!0,beginAtZero:!0,min:0,max:t},y1:{position:"right",beginAtZero:!0,min:0,max:h,grid:{drawOnChartArea:!1}}}};return{data:w,options:T}}function ee(e,d,p){if(!(e!=null&&e.length))return{data:{labels:[],datasets:[]},options:F()};e=B(e,t=>t.totalApproved).slice(0,p);const g=e.map(t=>t.totalApproved),l=e.map(t=>t.totalRejected),r=e.map(t=>t.remainingPRCount),i=e.map(t=>t.user),A=i.map(t=>t.displayName||t.name),u=e.map(t=>t.cycleTime),o=e.map(t=>t.averageAge),b=O(e,t=>t.totalPRCount),k=Math.ceil(O(o)||15),m=i.length<5?80:void 0,R=[g.some(t=>t>0)&&{label:"Approved",data:g,backgroundColor:"#4CAF50",type:"bar",stack:"stack1",borderRadius:2,barThickness:m,yAxisID:"y"},l.some(t=>t>0)&&{label:"Rejected",data:l,backgroundColor:"#F44336",type:"bar",stack:"stack1",borderRadius:2,barThickness:m,yAxisID:"y"},r.some(t=>t>0)&&{label:"Not Reviewed",data:r,backgroundColor:"#FFC107",type:"bar",stack:"stack1",borderRadius:2,barThickness:m,yAxisID:"y"},{label:"Age",data:o,borderColor:"#FF9800",backgroundColor:"rgba(255,152,0,0.5)",type:"line",fill:!1,yAxisID:"y1"},{label:"Cycle Time",data:u,borderColor:"#2196F3",backgroundColor:"rgba(33,150,243,0.5)",type:"line",fill:!1,yAxisID:"y1"}].filter(Boolean),x={labels:A,datasets:R},P={...F(),onClick:(t,h)=>{var v;const y=(v=h==null?void 0:h[0])==null?void 0:v.index;y>=0&&(d==null||d(i[y]))},scales:{x:{stacked:!0,ticks:{display:!1},afterFit:t=>t.height=50},y:{stacked:!0,beginAtZero:!0,min:0,max:b},y1:{position:"right",beginAtZero:!0,min:0,max:k,grid:{drawOnChartArea:!1}}},users:i};return{data:x,options:P}}export{S as a,ee as b,Q as c,K as g};
