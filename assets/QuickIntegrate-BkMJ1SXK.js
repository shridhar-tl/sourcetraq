import{r as i,j as t,c as x,y as M,z as j,A,C as E,D as I,E as G,F as H,L as q,B as C,G as S,H as D,I as P,m as w,J as v,K as R,M as U,N as k,O as $}from"../index.DfrHbMj8.js";const K=e=>i.createElement("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",fill:"none",...e},i.createElement("path",{stroke:"#000000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8V6a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v2M3 8v10a2 2 0 0 0 2 2h4M3 8h18m0 0v2m-6 7h.001M18 19h.001M22 17a5 5 0 1 1-5-5v2h3v3h2z"})),O=e=>i.createElement("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},i.createElement("path",{d:"M9 17.5C9 18.8807 7.88071 20 6.5 20C5.11929 20 4 18.8807 4 17.5C4 16.1193 5.11929 15 6.5 15C7.88071 15 9 16.1193 9 17.5ZM9 17.5H15.125M19 20V17.75C19 17.6119 18.8881 17.5 18.75 17.5M15.125 17.5H18.75M15.125 17.5V20M18.75 17.5Lnan nanCnan nan nan nan nan nanLnan nanCnan nan nan nan nan nanL18.75 17.5ZM5 11H19C20.1046 11 21 10.1046 21 9V6C21 4.89543 20.1046 4 19 4H5C3.89543 4 3 4.89543 3 6V9C3 10.1046 3.89543 11 5 11Z",stroke:"#000000",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}),i.createElement("circle",{cx:7.5,cy:7.5,r:1.5,fill:"#000000"}),i.createElement("circle",{cx:12,cy:7.5,r:1.5,fill:"#000000"}),i.createElement("circle",{cx:16.5,cy:7.5,r:1.5,fill:"#000000"})),V=e=>i.createElement("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},i.createElement("path",{d:"M2 12C2 8.22876 2 6.34315 3.17157 5.17157C4.34315 4 6.22876 4 10 4H14C17.7712 4 19.6569 4 20.8284 5.17157C22 6.34315 22 8.22876 22 12C22 15.7712 22 17.6569 20.8284 18.8284C19.6569 20 17.7712 20 14 20H10C6.22876 20 4.34315 20 3.17157 18.8284C2 17.6569 2 15.7712 2 12Z",stroke:"#1C274C",strokeWidth:1.5}),i.createElement("path",{d:"M12.0002 10V14M10.2678 11L13.7319 13M13.7317 11L10.2676 13",stroke:"#1C274C",strokeWidth:1.5,strokeLinecap:"round"}),i.createElement("path",{d:"M6.73266 10V14M5.00023 11L8.46434 13M8.4641 11L5 13",stroke:"#1C274C",strokeWidth:1.5,strokeLinecap:"round"}),i.createElement("path",{d:"M17.2681 10V14M15.5356 11L18.9997 13M18.9995 11L15.5354 13",stroke:"#1C274C",strokeWidth:1.5,strokeLinecap:"round"}));function y({items:e,value:r,onChange:s}){return t.jsx("div",{className:"flex flex-wrap gap-2",children:e.map(a=>t.jsx(W,{text:a.label,icon:a.icon,disabled:a.disabled,tooltip:a.tooltip,selected:r===a.value,onClick:()=>s(a.value)},a.value))})}function W({selected:e,onClick:r,icon:s,text:a,tooltip:d,disabled:o}){const l=x("flex items-center space-x-2 rounded-sm border px-2 py-1.5 cursor-pointer transition-colors",{"border-blue-500":e,"border-gray-300":!e,"opacity-60":o}),m=x("w-4 h-4 rounded-full border mr-2 flex items-center justify-center",{"border-blue-500":e,"border-gray-400":!e}),h=x("w-2 h-2 rounded-full bg-blue-500",{hidden:!e});return t.jsxs("button",{type:"button",onClick:r,className:l,disabled:o,title:d,children:[t.jsx("div",{className:m,children:t.jsx("div",{className:h})}),s,t.jsx("span",{children:a})]})}const F=[{value:"BitBucketServer",label:"Bitbucket Server",icon:t.jsx(S,{className:"w-5 h-5"})},{value:"BitBucketCloud",label:"Bitbucket Cloud",icon:t.jsx(S,{className:"w-5 h-5"})},{value:"GitHubCloud",label:"GitHub Cloud",icon:t.jsx(D,{className:"w-5 h-5"})},{value:"GitLabCloud",label:"GitLab Cloud",icon:t.jsx(P,{className:"w-5 h-5"})}],g=j&&T(),B=t.jsx("footer",{className:"mt-6 mb-1 text-sm text-center text-gray-600",children:t.jsxs("p",{children:["Â© ",new Date().getFullYear()," SourceTraq. All rights reserved. |"," ",t.jsx(q,{href:"https://sourcetraq.com/install-options",className:"text-blue-500 hover:underline",children:"Help"})]})});function ee({initialUrl:e}){const[r,s]=i.useState(!1),[a,d]=i.useState({}),[o,l]=i.useState(e||""),[m,h]=i.useState(p(e||"")),[f,u]=i.useState(Y(e||""));i.useEffect(()=>{o&&h(p(o))},[o]),i.useEffect(()=>{e&&(l(e),h(p(e)))},[e]),i.useEffect(()=>{l(c=>M(m,c||e)||X(e))},[m]);const n=()=>{var c;if(m==="BitBucketServer"&&!o){k("BitBucket url is required before you can integrate","SourceTraq",{type:"error"});return}if(f==="BASIC"&&(((c=a.apiKey)==null?void 0:c.length)||0)<5){k("Either API Key or user name and password is required to integrate","SourceTraq",{type:"error"});return}return N(o,m,f,a)};return t.jsxs("div",{className:x("items-center bg-gray-100",{"w-[480px] min-h-[470px]":g,"min-h-screen flex flex-col justify-center":!g}),children:[t.jsxs("div",{className:"w-[480px] bg-white rounded-lg shadow-lg p-6",children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[r&&t.jsx(A,{className:"w-6 h-6 cursor-pointer hover:opacity-75",onClick:()=>{s(!1),d({})}}),t.jsx(E,{className:"w-7 h-7"}),t.jsx("h1",{className:"text-xl font-bold",children:"SourceTraq"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Repository URL"}),t.jsx("input",{type:"text",value:o,onChange:c=>l(c.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring focus:border-blue-300"})]}),!r&&t.jsx(Z,{selectedRepo:m,setSelectedRepo:h,authType:f,setAuthType:u,setShowCredential:s,onDone:n}),r&&t.jsx(z,{options:a,setOptions:d,onDone:n}),g&&B]}),!g&&B,t.jsx(I,{}),t.jsx(G,{})]})}function Z({selectedRepo:e,setSelectedRepo:r,authType:s,setAuthType:a,setShowCredential:d,onDone:o}){const l=i.useMemo(()=>[{value:"SESSION",label:e==="GitHubCloud"||e==="GitLabCloud"?"Anonymous":"Session",disabled:e==="BitBucketCloud",icon:t.jsx(K,{className:"w-5 h-5"})},{value:"BASIC",label:"Auth Key",icon:t.jsx(V,{className:"w-5 h-5"})},{value:"oAuth",label:"oAuth",disabled:!0,tooltip:"Currently unavailable. Coming soon.",icon:t.jsx(O,{className:"w-5 h-5"})}],[e]);return i.useEffect(()=>{s!=="BASIC"&&e!=="BitBucketServer"&&a("BASIC")},[e]),t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("p",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Repository Type"}),t.jsx(y,{value:e,items:F,onChange:r})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("p",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Authentication Type"}),t.jsx(y,{value:s,items:l,onChange:a})]}),t.jsxs("div",{children:[s==="SESSION"&&t.jsx(C,{variant:"primary",onClick:o,className:"w-full py-2",label:"Integrate",loadingMessage:"Authenticating..."}),s==="BASIC"&&t.jsx(C,{variant:"primary",onClick:()=>d(!0),className:"w-full py-2",label:"Provide Credentials"})]})]})}function z({options:e,setOptions:r,onDone:s}){const a=o=>r(l=>({...l,username:o.target.value})),d=o=>r(l=>({...l,apiKey:o.target.value}));return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:g?"my-6":"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"User name / Login"}),t.jsx("input",{type:"text",value:e.username||"",onChange:a,className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring focus:border-blue-300"})]}),t.jsxs("div",{className:g?"mb-6":"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password / API Key"}),t.jsx("input",{type:"password",value:e.apiKey||"",onChange:d,className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring focus:border-blue-300"})]}),t.jsx(C,{variant:"primary",onClick:s,className:x("w-full py-2",g?"my-8":"mt-6"),label:"Integrate",loadingMessage:"Authenticating..."})]})}function p(e){if(!e)return"BitBucketServer";try{const s=new URL(e).hostname.toLowerCase();if(s.includes("github"))return"GitHubCloud";if(s.includes("gitlab"))return"GitLabCloud";if(s.includes("bitbucket.org"))return"BitBucketCloud"}catch{}return"BitBucketServer"}function Y(e){if(!e)return"SESSION";try{const s=new URL(e).hostname.toLowerCase();if(s.includes("github")||s.includes("gitlab")||s.includes("bitbucket.org"))return"BASIC"}catch{}return"SESSION"}async function N(e,r,s,a){const{$repository:d,$browser:o,$session:l,$integration:m,$message:h}=w("AjaxService","BrowserService","SessionService","IntegrationService","MessageService","RepositoryService"),f=r!=="BitBucketServer"||s!=="SESSION"||await o.requestPermission(null,e);l.clear();const u={authType:s,name:Q(r),type:r,url:e,options:{},isActive:!0,addedDate:new Date};if(s==="BASIC"){const{username:n,apiKey:c}=a;u.options={username:n,apiKey:c}}if(r==="GitHubCloud"){const n=v(e,"github.com");u.name=n?`${n} (GitHub)`:"GitHub",n&&(u.options.org=n)}else if(r==="GitLabCloud"){const n=v(e,"gitlab.com");u.name=n?`${n} (GitLab)`:"GitLab",n&&(u.options.org=n)}else if(r==="BitBucketCloud"){const n=v(e,"bitbucket.org");u.name=n?`${n} (BitBucket)`:"BitBucket Cloud",n&&(u.options.workspace=n)}l.setIntegration(u);try{const n=await d.isAuthenticated(),c=typeof n=="object";if(n===!0||c&&n.isSuccess)try{c&&(u.options={...u.options,...n.options});const b=await m.add(u);J(b)}catch{const{$message:L}=w("MessageService");L.error("Unable to save integration details. Verify if you have sufficient free space in your drive","Allocation failed")}else console.log("You are not authenticated"),h.warning("You are not authenticated with Selected Repository to integrate.","Unauthorized")}catch(n){n=n||{};const c=R(U(e),"/");if(c&&c!==e)await N(c,r,s,a);else if(f)h.error(`This is not a valid ${r} url or the server does not respond.`,"Unknown server");else{let b="Permission denied to access this Url. ";$?b+="Try integrating directly from extension by clicking on SourceTraq icon or manually grant permission and retry.":b+="Manually grant permission and then retry.",h.error(b,"Permission Denied")}}}function Q(e){if(e==="BitBucketServer")return"BitBucket Server";if(e==="BitBucketCloud")return"BitBucket Cloud";if(e==="GitHubCloud")return"GitHub Cloud";if(e==="GitLabCloud")return"GitLab Cloud"}async function J(e){if(e.id<=0)return;const r=(j?"/index.html#/":"/")+e.id;if(g){const{$browser:s}=w("BrowserService");s.openTab(r),window.close()}else document.location.href=r}function T(){return new URLSearchParams(window.location.search).get("quick")==="true"}function X(e){if(!e)return"";const r=["github.com","gitlab.com","bitbucket.org"];try{const s=new URL(e);return r.some(a=>s.hostname.endsWith(a))?"":H(e)}catch{return e}}export{ee as default};
