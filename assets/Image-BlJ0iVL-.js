import{i as R,o as y,e as j,p as P,c as N,r as _,j as O,q as $}from"../index.qPuWtL5Z.js";import{t as r,g as x}from"./chart-options-BM9C3PSU.js";function K(e,l){const g=Object.keys(e||{});return g.length?g.filter(n=>e[n].prList.length).map(n=>{const o=e[n],m=l==null?void 0:l[n],D=(o==null?void 0:o.commits)??[],f=(m==null?void 0:m.commits)??[],c=(o==null?void 0:o.prList)??[],p=(m==null?void 0:m.prList)??[],b=D.length,k=f.length,A=b-k,s=k>0?A/k*100:100,v=c.length,h=p.length,C=v-h,I=h>0?C/h*100:100,E=c.filter(t=>t.state==="MERGED").length,a=c.filter(t=>t.state==="DECLINED").length,i=p.filter(t=>t.state==="DECLINED").length,L=a-i,Q=i>0?L/i*100:100,M=[],B=[],Z=[],z=[],U=[],Y=[],F=[],G=[];c.forEach(t=>{if(t.closedDate){const u=t.createdDate instanceof Date?t.createdDate:new Date(t.createdDate),w=t.closedDate instanceof Date?t.closedDate:new Date(t.closedDate);M.push(R(w,u))}const{firstCommitDate:W,createdDate:X,firstActivityDate:q,approveDate:H}=t.properties.cycleTime;if(B.push(R(new Date(X),new Date(W))),t.state==="MERGED"){const u=t.createdDate instanceof Date?t.createdDate:new Date(t.createdDate),w=t.closedDate instanceof Date?t.closedDate:new Date(t.closedDate);Z.push(R(w,u))}if(H){const u=t.createdDate instanceof Date?t.createdDate:new Date(t.createdDate);z.push(R(new Date(H),u))}if(q){const u=t.createdDate instanceof Date?t.createdDate:new Date(t.createdDate);G.push(R(new Date(q),u))}const J=t.reviewers??[];U.push(J.length),Y.push(J.filter(u=>u.approved===!0).length),F.push(t.properties.commentCount)});const V=p.map(t=>t.properties.commentCount)??[],T=y(V);return{user:o.user,totalCommits:b,commitDelta:{diff:r(A),percent:r(s)},totalPRs:v,prDelta:{diff:r(C),percent:r(I)},mergedPRs:E,declinedPRs:a,declinedDelta:{diff:r(L),percent:r(Q)},avgPROpenDays:r(y(M)),avgDaysFirstCommitToPR:r(y(B)),avgDaysPRToMerge:r(y(Z)),avgDaysPRToApproval:r(y(z)),avgReviewers:r(y(U)),avgReviewersApproved:r(y(Y)),avgComments:r(y(F)),commentDelta:{diff:r(y(F)-T),percent:T>0?r((y(F)-T)/T*100):100},avgDaysFirstActivity:r(y(G))}}):[]}function se(e){if(!e||e.length===0)return{data:{labels:[],datasets:[]},options:x()};e=j(e.filter(c=>c.totalCommits),c=>c.totalCommits).slice(0,15);const l=e.map(c=>c.totalCommits),g=e.map(c=>c.user),d=g.map(c=>c.displayName||c.name),n=P(l)||15,o=l.length<5?80:void 0,D={labels:d,datasets:[{label:"Commits",data:l,backgroundColor:"#4CAF50",type:"bar",stack:"stack1",borderRadius:2,barThickness:o,yAxisID:"y"}]},f={...x(),scales:{x:{stacked:!0,ticks:{display:!1},afterFit:c=>c.height=50},y:{stacked:!0,beginAtZero:!0,min:0,max:n}},plugins:{legend:{display:!1}},users:g};return{data:D,options:f}}function ce(e,l,g){if(!e||e.length===0)return{data:{labels:[],datasets:[]},options:x()};e=j(e.filter(a=>a.totalPRs),a=>a.totalPRs).slice(0,15);const d=e.map(a=>a.mergedPR),n=e.map(a=>a.openPR),o=e.map(a=>a.declinedPR),m=e.map(a=>a.unknownPR),D=e.map(a=>a.user),f=D.map(a=>a.displayName||a.name),c=m.some(a=>a>0),p=K(l,g).reduce((a,i)=>(a[i.user.name]=i,a),{}),b=e.map(a=>{var i;return((i=p[a.user.name])==null?void 0:i.avgDaysPRToMerge)??0}),k=e.map(a=>{var i;return((i=p[a.user.name])==null?void 0:i.avgPROpenDays)??0}),A=e.map(a=>{var i;return((i=p[a.user.name])==null?void 0:i.avgDaysPRToApproval)??0}),s=P(e.map(a=>a.totalPRs))||15,v=P(k)||15,h=D.length<5?80:void 0,C=[{label:"Merged",data:d,backgroundColor:"#4CAF50",type:"bar",stack:"stack1",borderRadius:2,barThickness:h,yAxisID:"y"},{label:"Open",data:n,backgroundColor:"#FFC107",type:"bar",stack:"stack1",borderRadius:2,barThickness:h,yAxisID:"y"},{label:"Declined",data:o,backgroundColor:"#F44336",type:"bar",stack:"stack1",borderRadius:2,barThickness:h,yAxisID:"y"},c&&{label:"Unknown",data:m,backgroundColor:"#9E9E9E",type:"bar",stack:"stack1",borderRadius:2,barThickness:h,yAxisID:"y"},{label:"Age",data:k,borderColor:"#FF9800",backgroundColor:"rgba(255,152,0,0.5)",type:"line",fill:!1,yAxisID:"y1"},{label:"Approval Days",data:A,borderColor:"#F44336",backgroundColor:"rgba(244,67,54,0.5)",type:"line",fill:!1,yAxisID:"y1"},{label:"Cycle Time",data:b,borderColor:"#2196F3",backgroundColor:"rgba(33,150,243,0.5)",type:"line",fill:!1,yAxisID:"y1"}].filter(Boolean),I={labels:f,datasets:C},E={...x(),users:D,scales:{x:{stacked:!0,ticks:{display:!1},afterFit:a=>a.height=50},y:{stacked:!0,beginAtZero:!0,min:0,max:s},y1:{position:"right",beginAtZero:!0,min:0,max:v,grid:{drawOnChartArea:!1}}}};return{data:I,options:E}}function ne(e){if(!(e!=null&&e.length))return{data:{labels:[],datasets:[]},options:x()};e=j(e,s=>s.totalApproved).slice(0,15);const l=e.map(s=>s.totalApproved),g=e.map(s=>s.totalRejected),d=e.map(s=>s.remainingPRCount),n=e.map(s=>s.user),o=n.map(s=>s.displayName||s.name),m=e.map(s=>s.cycleTime),D=e.map(s=>s.averageAge),f=P(e,s=>s.totalPRCount),c=Math.ceil(P(D)||15),p=n.length<5?80:void 0,b=[l.some(s=>s>0)&&{label:"Approved",data:l,backgroundColor:"#4CAF50",type:"bar",stack:"stack1",borderRadius:2,barThickness:p,yAxisID:"y"},g.some(s=>s>0)&&{label:"Rejected",data:g,backgroundColor:"#F44336",type:"bar",stack:"stack1",borderRadius:2,barThickness:p,yAxisID:"y"},d.some(s=>s>0)&&{label:"Not Reviewed",data:d,backgroundColor:"#FFC107",type:"bar",stack:"stack1",borderRadius:2,barThickness:p,yAxisID:"y"},{label:"Age",data:D,borderColor:"#FF9800",backgroundColor:"rgba(255,152,0,0.5)",type:"line",fill:!1,yAxisID:"y1"},{label:"Cycle Time",data:m,borderColor:"#2196F3",backgroundColor:"rgba(33,150,243,0.5)",type:"line",fill:!1,yAxisID:"y1"}].filter(Boolean),k={labels:o,datasets:b},A={...x(),scales:{x:{stacked:!0,ticks:{display:!1},afterFit:s=>s.height=50},y:{stacked:!0,beginAtZero:!0,min:0,max:f},y1:{position:"right",beginAtZero:!0,min:0,max:c,grid:{drawOnChartArea:!1}}},users:n};return{data:k,options:A}}function oe(e){const{size:l="sm"}=e,g=N({"size-6":l==="xs","size-10":l==="sm"}),{src:d,displayName:n}=e,[o,m]=_.useState({src:d,fallback:!1}),D=(n==null?void 0:n.trim())&&O.jsx("div",{className:N("rounded-full bg-gray-100 flex-shrink-0 flex justify-center",g),children:O.jsx("span",{className:"my-auto text-sm",children:$(n)})});if(!d||S(d).length<3)return D||null;if(D&&o.fallback&&o.src===d)return D;const{alt:f="",className:c,title:p}=e;return O.jsx("img",{src:d,alt:f,title:p||n,onError:()=>m({src:d,fallback:!0}),className:N(g,c)})}function S(e){try{return new URL(e).pathname}catch{return""}}export{oe as I,ce as a,ne as b,K as c,se as g};
