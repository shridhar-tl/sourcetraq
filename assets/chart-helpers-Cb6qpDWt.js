import{h as x,e as D,i as w,m as P}from"../index.f7nfUctD.js";import{t as c,g as R}from"./chart-options-mACXGUK2.js";function W(e,l){const p=Object.keys(e||{});return p.length?p.filter(i=>e[i].prList.length).map(i=>{const r=e[i],d=l==null?void 0:l[i],g=(r==null?void 0:r.commits)??[],h=(d==null?void 0:d.commits)??[],o=(r==null?void 0:r.prList)??[],m=(d==null?void 0:d.prList)??[],A=g.length,f=h.length,b=A-f,s=f>0?b/f*100:100,v=o.length,k=m.length,C=v-k,I=k>0?C/k*100:100,E=o.filter(t=>t.state==="MERGED").length,a=o.filter(t=>t.state==="DECLINED").length,n=m.filter(t=>t.state==="DECLINED").length,M=a-n,H=n>0?M/n*100:100,L=[],N=[],B=[],Z=[],j=[],U=[],F=[],Y=[];o.forEach(t=>{if(t.closedDate){const y=t.createdDate instanceof Date?t.createdDate:new Date(t.createdDate),O=t.closedDate instanceof Date?t.closedDate:new Date(t.closedDate);L.push(x(O,y))}const{firstCommitDate:Q,createdDate:V,firstActivityDate:G,approveDate:q}=t.properties.cycleTime;if(N.push(x(new Date(V),new Date(Q))),t.state==="MERGED"){const y=t.createdDate instanceof Date?t.createdDate:new Date(t.createdDate),O=t.closedDate instanceof Date?t.closedDate:new Date(t.closedDate);B.push(x(O,y))}if(q){const y=t.createdDate instanceof Date?t.createdDate:new Date(t.createdDate);Z.push(x(new Date(q),y))}if(G){const y=t.createdDate instanceof Date?t.createdDate:new Date(t.createdDate);Y.push(x(new Date(G),y))}const z=t.reviewers??[];j.push(z.length),U.push(z.filter(y=>y.approved===!0).length),F.push(t.properties.commentCount)});const J=m.map(t=>t.properties.commentCount)??[],T=D(J);return{user:r.user,totalCommits:A,commitDelta:{diff:c(b),percent:c(s)},totalPRs:v,prDelta:{diff:c(C),percent:c(I)},mergedPRs:E,declinedPRs:a,declinedDelta:{diff:c(M),percent:c(H)},avgPROpenDays:c(D(L)),avgDaysFirstCommitToPR:c(D(N)),avgDaysPRToMerge:c(D(B)),avgDaysPRToApproval:c(D(Z)),avgReviewers:c(D(j)),avgReviewersApproved:c(D(U)),avgComments:c(D(F)),commentDelta:{diff:c(D(F)-T),percent:T>0?c((D(F)-T)/T*100):100},avgDaysFirstActivity:c(D(Y))}}):[]}function K(e){if(!e||e.length===0)return{data:{labels:[],datasets:[]},options:R()};e=w(e.filter(o=>o.totalCommits),o=>o.totalCommits).slice(0,15);const l=e.map(o=>o.totalCommits),p=e.map(o=>o.user),u=p.map(o=>o.displayName||o.name),i=P(l)||15,r=l.length<5?80:void 0,g={labels:u,datasets:[{label:"Commits",data:l,backgroundColor:"#4CAF50",type:"bar",stack:"stack1",borderRadius:2,barThickness:r,yAxisID:"y"}]},h={...R(),scales:{x:{stacked:!0,ticks:{display:!1},afterFit:o=>o.height=50},y:{stacked:!0,beginAtZero:!0,min:0,max:i}},plugins:{legend:{display:!1}},users:p};return{data:g,options:h}}function S(e,l,p){if(!e||e.length===0)return{data:{labels:[],datasets:[]},options:R()};e=w(e.filter(a=>a.totalPRs),a=>a.totalPRs).slice(0,15);const u=e.map(a=>a.mergedPR),i=e.map(a=>a.openPR),r=e.map(a=>a.declinedPR),d=e.map(a=>a.unknownPR),g=e.map(a=>a.user),h=g.map(a=>a.displayName||a.name),o=d.some(a=>a>0),m=W(l,p).reduce((a,n)=>(a[n.user.name]=n,a),{}),A=e.map(a=>{var n;return((n=m[a.user.name])==null?void 0:n.avgDaysPRToMerge)??0}),f=e.map(a=>{var n;return((n=m[a.user.name])==null?void 0:n.avgPROpenDays)??0}),b=e.map(a=>{var n;return((n=m[a.user.name])==null?void 0:n.avgDaysPRToApproval)??0}),s=P(e.map(a=>a.totalPRs))||15,v=P(f)||15,k=g.length<5?80:void 0,C=[{label:"Merged",data:u,backgroundColor:"#4CAF50",type:"bar",stack:"stack1",borderRadius:2,barThickness:k,yAxisID:"y"},{label:"Open",data:i,backgroundColor:"#FFC107",type:"bar",stack:"stack1",borderRadius:2,barThickness:k,yAxisID:"y"},{label:"Declined",data:r,backgroundColor:"#F44336",type:"bar",stack:"stack1",borderRadius:2,barThickness:k,yAxisID:"y"},o&&{label:"Unknown",data:d,backgroundColor:"#9E9E9E",type:"bar",stack:"stack1",borderRadius:2,barThickness:k,yAxisID:"y"},{label:"Age",data:f,borderColor:"#FF9800",backgroundColor:"rgba(255,152,0,0.5)",type:"line",fill:!1,yAxisID:"y1"},{label:"Approval Days",data:b,borderColor:"#F44336",backgroundColor:"rgba(244,67,54,0.5)",type:"line",fill:!1,yAxisID:"y1"},{label:"Cycle Time",data:A,borderColor:"#2196F3",backgroundColor:"rgba(33,150,243,0.5)",type:"line",fill:!1,yAxisID:"y1"}].filter(Boolean),I={labels:h,datasets:C},E={...R(),users:g,scales:{x:{stacked:!0,ticks:{display:!1},afterFit:a=>a.height=50},y:{stacked:!0,beginAtZero:!0,min:0,max:s},y1:{position:"right",beginAtZero:!0,min:0,max:v,grid:{drawOnChartArea:!1}}}};return{data:I,options:E}}function ee(e){if(!(e!=null&&e.length))return{data:{labels:[],datasets:[]},options:R()};e=w(e,s=>s.totalApproved).slice(0,15);const l=e.map(s=>s.totalApproved),p=e.map(s=>s.totalRejected),u=e.map(s=>s.remainingPRCount),i=e.map(s=>s.user),r=i.map(s=>s.displayName||s.name),d=e.map(s=>s.cycleTime),g=e.map(s=>s.averageAge),h=P(e,s=>s.totalPRCount),o=Math.ceil(P(g)||15),m=i.length<5?80:void 0,A=[l.some(s=>s>0)&&{label:"Approved",data:l,backgroundColor:"#4CAF50",type:"bar",stack:"stack1",borderRadius:2,barThickness:m,yAxisID:"y"},p.some(s=>s>0)&&{label:"Rejected",data:p,backgroundColor:"#F44336",type:"bar",stack:"stack1",borderRadius:2,barThickness:m,yAxisID:"y"},u.some(s=>s>0)&&{label:"Not Reviewed",data:u,backgroundColor:"#FFC107",type:"bar",stack:"stack1",borderRadius:2,barThickness:m,yAxisID:"y"},{label:"Age",data:g,borderColor:"#FF9800",backgroundColor:"rgba(255,152,0,0.5)",type:"line",fill:!1,yAxisID:"y1"},{label:"Cycle Time",data:d,borderColor:"#2196F3",backgroundColor:"rgba(33,150,243,0.5)",type:"line",fill:!1,yAxisID:"y1"}].filter(Boolean),f={labels:r,datasets:A},b={...R(),scales:{x:{stacked:!0,ticks:{display:!1},afterFit:s=>s.height=50},y:{stacked:!0,beginAtZero:!0,min:0,max:h},y1:{position:"right",beginAtZero:!0,min:0,max:o,grid:{drawOnChartArea:!1}}},users:i};return{data:f,options:b}}export{S as a,ee as b,W as c,K as g};
