import{j as e,S as f,c as g,r as b,g as m,a as M,b as D,f as S,d as T}from"../index.f7nfUctD.js";import{u as j,C as h,S as A,a as k,b as I,c as F,d as E,e as U,P as z}from"./chart-options-mACXGUK2.js";import{g as q}from"./chart-helpers-Cb6qpDWt.js";function B({count:s=5,structure:a,bordered:l}){return e.jsx("div",{className:"flex flex-col gap-1",children:Array.from({length:s}).map((t,r)=>e.jsx(f,{className:g("w-full h-17 px-4 bg-white",{"border-b border-gray-200":l}),children:a.map(({width:n="90%",height:o="8px",radius:d="4px"},c)=>e.jsx("div",{className:"bg-slate-200 my-2",style:{width:n,height:o,borderRadius:d}},c))},r))})}function G(){const{current:s,previous:a,daysCount:l,isLoading:t,settings:r}=j(),n=(r==null?void 0:r.prChangesDisplay)!=="none",o=s==null?void 0:s.topContributors,d=a==null?void 0:a.topContributors,{data:c,options:p,totalCount:C,totalCountChange:N}=b.useMemo(()=>{const{data:y,options:P}=q(o),u=o==null?void 0:o.filter(i=>i.totalCommits>0).length,v=d==null?void 0:d.filter(i=>i.totalCommits>0).length,R=n?m(u,v):void 0;return{data:y,options:P,totalCount:u,totalCountChange:R}},[o,d]),w=n?m(s==null?void 0:s.totalCommits,a==null?void 0:a.totalCommits):void 0;return e.jsxs("div",{className:"bg-white shadow-lg rounded-md px-4 pt-4 flex flex-col flex-1",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h3",{className:"text-lg font-extrabold text-gray-600",children:"Contributions"})}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-around mb-3 w-full",children:[e.jsx(h,{isLoading:t,total:l,icon:A,iconProps:{fill:"#00c951"},label:"Days",textClassName:"text-green-700"}),e.jsx(h,{isLoading:t,total:s.totalCommits,change:w,icon:M,iconProps:{fill:"#1447e6"},label:"Commits",textClassName:"text-blue-700"}),e.jsx(h,{isLoading:t,total:C,change:N,icon:k,iconProps:{fill:"#c10007",className:"h-7 w-7 my-auto"},label:"Contributors",textClassName:"text-green-800"})]}),e.jsxs("div",{className:"w-full flex-1",children:[t&&e.jsx("div",{className:"pb-4 h-88",children:e.jsx(I,{count:15,order:"desc"})}),!t&&!!c&&e.jsx(F,{data:c,options:p,type:"bar",width:"100%",height:370})]})]})}function H(s){const{src:a,displayName:l}=s,[t,r]=b.useState({src:a,fallback:!1}),n=(l==null?void 0:l.trim())&&e.jsx("div",{className:"size-10 rounded-full bg-gray-100 flex-shrink-0 flex justify-center",children:e.jsx("span",{className:"my-auto text-sm",children:D(l)})});if(!a||O(a).length<3)return n||null;if(n&&t.fallback&&t.src===a)return n;const{alt:o="",className:d,title:c}=s;return e.jsx("img",{src:a,alt:o,title:c,onError:()=>r({src:a,fallback:!0}),className:g("size-10",d)})}function O(s){try{return new URL(s).pathname}catch{return""}}const W=[{width:"90%",height:"22px"},{width:"35%",height:"16px"}];function _({activities:s,isLoading:a}){return e.jsxs("div",{className:"w-full bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"px-4 py-2 border-b border-gray-300",children:e.jsx("h2",{className:"text-lg font-medium text-gray-800",children:"Recent Activity"})}),a&&e.jsx(B,{count:6,structure:W,bordered:!0}),!a&&!!(s!=null&&s.length)&&e.jsx($,{activities:s}),!a&&!(s!=null&&s.length)&&e.jsx("div",{className:"p-2 text-center text-sm",children:"No activities to show"})]})}function $({activities:s}){return e.jsx("ul",{children:s.map((a,l)=>e.jsxs("li",{className:"px-4 py-3 border-b border-gray-200 last:border-0 hover:bg-gray-50 transition-colors duration-200 flex gap-3",children:[e.jsx(H,{src:a.user.avatar,className:"rounded-full my-auto",displayName:a.user.displayName||a.user.name}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-700 text-sm",children:a.message}),e.jsxs("span",{className:"text-xs text-gray-500",children:[a.user.displayName||a.user.name," on ",S(a.timestamp)]})]})]},l))})}const J=({current:s,previous:a,isLoading:l})=>{const t=m(s.totalPRCount,a.totalPRCount),r=m(s.totalMergedPRs,a.totalMergedPRs),n=m(s.totalDeclinedPRs,a.totalDeclinedPRs),o=m(s.averageTimeToMergeInMS,a.averageTimeToMergeInMS);return e.jsx("div",{className:"flex flex-col md:flex-row p-6 bg-white shadow-lg rounded-lg mb-6",children:e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-gray-600",children:"Metrics"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 2xl:grid-cols-4 gap-4",children:[e.jsx(x,{isLoading:l,label:"Total PRs",value:s.totalPRCount,change:t}),e.jsx(x,{isLoading:l,label:"Merged PRs",value:s.totalMergedPRs,change:r}),e.jsx(x,{isLoading:l,label:"Declined PRs",value:s.totalDeclinedPRs,change:n,upArrow:n>=0,positive:!s.totalDeclinedPRs||n<0}),e.jsx(x,{isLoading:l,label:"Time to Merge (Avg.)",value:T(s.averageTimeToMergeInMS),change:o,upArrow:o>=0,positive:o<=0})]})]})})};function x({isLoading:s,label:a,value:l,change:t,positive:r=(t||0)>=0,upArrow:n=r}){if(s)return e.jsx(f,{className:"rounded-lg h-29"});const o=n?E:U;return e.jsxs("div",{className:g("border-1 border-gray-200 p-4 rounded-lg border-s-4 rounded-s-none ",{"border-s-[#6768eb]":!t,"border-s-red-500":!!t&&!r,"border-s-green-500":!!t&&r}),children:[e.jsx("h3",{className:"text-sm",children:a}),e.jsx("p",{className:"text-xl font-semibold",children:l}),!!t&&e.jsxs("span",{className:`flex text-xs mt-2 items-center ${r?"text-green-500":"text-red-500"}`,children:[e.jsx(o,{className:"w-3 h-3",stroke:r?"#059669":"red"}),Math.abs(t),"%"]})]})}function X(){const{current:s,previous:a,isLoading:l,settings:t}=j();return e.jsxs("div",{children:[e.jsx(z,{title:"Dashboard"}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 mb-4 lg:mb-0 gap-4 w-full lg:max-w-1/2",children:[e.jsx(J,{current:s,previous:a,isLoading:l}),(t==null?void 0:t.includeCommits)!==!1&&e.jsx(G,{})]}),e.jsx("div",{className:"flex-1",children:e.jsx(_,{activities:s.recentActivity,isLoading:l})})]})]})}export{X as default};
