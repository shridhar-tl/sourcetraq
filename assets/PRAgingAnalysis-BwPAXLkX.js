import{j as r,r as A,U as $,O as B,V as N,W as I,e as O,m as S,X as n,Y as k}from"../index.B8kfND-w.js";import{S as q,g as T,T as E,b as U,a as L}from"./PRActivityDetails-FPY38KXY.js";import{C as R,S as C,a as W,b as _,c as F,u as G,O as H,P as V}from"./chart-options-DM8ui2XP.js";function X({data:c,options:f,metrics:p,isLoading:e}){const{averagePRAge:d,contributorCount:t,maxPRAge:i,totalPRCount:u}=p||{};return r.jsxs("div",{className:"bg-white shadow-lg rounded-md px-4 pt-4 flex flex-col flex-1 w-full",children:[r.jsx("div",{className:"flex justify-between items-center mb-4",children:r.jsx("h3",{className:"text-lg font-extrabold text-gray-600",children:"Open Pull Requests"})}),r.jsxs("div",{className:"flex flex-col md:flex-row justify-around mb-3 w-full",children:[r.jsx(R,{isLoading:e,total:d,label:"Avg. Age",icon:C,iconProps:{fill:"#00c951"},textClassName:"text-green-700"}),r.jsx(R,{isLoading:e,total:i,label:"Max Age",icon:C,iconProps:{fill:"#00c951"},textClassName:"text-green-700"}),r.jsx(R,{isLoading:e,total:u,label:"Total Count",icon:q,iconProps:{fill:"#00c951"},textClassName:"text-green-700"}),r.jsx(R,{isLoading:e,total:t,label:"Contributors",icon:W,iconProps:{fill:"#00c951"},textClassName:"text-green-700"})]}),r.jsxs("div",{className:"w-full flex-1",children:[e&&r.jsx("div",{className:"pb-4 h-88",children:r.jsx(_,{count:15,order:"desc",legendsCount:4})}),!e&&!!c&&r.jsx(F,{data:c,options:f,type:"bar",width:"100%",height:370})]})]})}function Y(){const{current:c,isLoading:f}=G(),p=(c==null?void 0:c.prList)||[],{openPRs:e,metrics:d,prDetails:t}=A.useMemo(()=>{const o=p.filter(s=>s.state==="OPEN"),h=T(o),g=$(h,s=>s.exactDaysOpen),b=B(h,s=>s.exactDaysOpen),a=N(h,s=>s.exactDaysOpen),l=I(o,s=>{var v,m;return(m=(v=s.author)==null?void 0:v.user)==null?void 0:m.name}),x={totalPRCount:o.length,contributorCount:l,averagePRAge:a,maxPRAge:b,minPRAge:g};return{openPRs:o,metrics:x,prDetails:O(h,s=>s.exactDaysOpen)}},[p]),{sortedPRs:i,bins:u}=A.useMemo(()=>{if(!(t!=null&&t.length))return{sortedPRs:[],bins:[]};const o=t.slice(0,20),h=o.map(b=>b.exactDaysOpen),g=Z(h).reverse();if(g.length){const b=g.length;g.forEach((a,l)=>{const x=Math.round(l/(b>1?b-1:1)*120);a.color=`hsl(${x}, 70%, 50%)`});for(const a of o)for(let l=0;l<g.length&&(a.binIndex=l,!(a.exactDaysOpen>=g[l].min));l++);}return{sortedPRs:o,bins:g}},[e]),y=A.useMemo(()=>{const o=i.map(a=>{var l;return(l=a.pr.author)==null?void 0:l.user}),h=o.map(a=>(a==null?void 0:a.displayName)||(a==null?void 0:a.name)||"Unknown"),g={label:"PR Age",originalData:i.map(a=>a.daysOpen),backgroundColor:i.map(a=>{var x;const l=a.binIndex;return((x=u[l])==null?void 0:x.color)||"gray"}),data:i.map(a=>a.daysOpen),prDetails:i.map(a=>a.pr),hiddenBins:Array(u.length).fill(!1)},b={...H(),plugins:{tooltip:{callbacks:{label:a=>{var v,m,M,P;const l=a.dataset,x=a.dataIndex,s=l.prDetails&&l.prDetails[x];if(s){const D=((m=(v=s.author)==null?void 0:v.user)==null?void 0:m.displayName)||((P=(M=s.author)==null?void 0:M.user)==null?void 0:P.name)||"Unknown",w=s.title||"",j=k(s.createdDate).toLocaleDateString();return[`Author: ${D}`,`Title: ${w}`,`Created: ${j}`,`Age: ${a.parsed.y} days`]}return""}}},legend:{labels:{generateLabels:a=>u.map((l,x)=>({text:l.label,fillStyle:l.color,binIndex:x,datasetIndex:0}))},onClick:(a,l,x)=>{const s=l.binIndex,v=x.chart,m=v.data.datasets[0];m.hiddenBins=m.hiddenBins||Array(u.length).fill(!1),m.hiddenBins[s]=!m.hiddenBins[s],m.data=m.originalData.map((M,P)=>i[P].binIndex===s&&m.hiddenBins[s]?null:M),v.update()}}},scales:{x:{ticks:{display:!1},afterFit:a=>a.height=50},y:{beginAtZero:!0,title:{display:!1,text:"PR Age (days)"}}},users:o};return{data:{labels:h,datasets:[g]},options:b}},[i,u]);return{data:y.data,options:y.options,isLoading:f,metrics:d,prDetails:t}}function Z(c){const f=Math.ceil(c[0]),p=Math.floor(c[c.length-1]),e=S(c,t=>Math.floor(t)).reverse();if(e.length<2)return[{label:`Below ${f} days`,color:"",min:p,max:f}];if(e.length<3)return[{label:`Below ${Math.ceil(n(e[0].values))} days`,min:p,max:Math.ceil(n(e[0].values)),color:""},{label:`Above ${Math.floor(e[1].values[0])} days`,min:Math.floor(e[1].values[0]),max:f,color:""}];if(e.length===3)return[{label:`Below ${Math.ceil(n(e[0].values))} days`,min:p,max:Math.ceil(n(e[0].values)),color:""},{label:`Below ${Math.ceil(n(e[1].values))} days`,min:Math.floor(e[1].values[0]),max:Math.ceil(n(e[1].values)),color:""},{label:`Above ${Math.floor(e[2].values[0])} days`,min:Math.floor(e[2].values[0]),max:f,color:""}];const d=[{label:`Below ${Math.ceil(n(e[0].values))} days`,min:p,max:Math.ceil(n(e[0].values)),color:""},{label:`Above ${Math.floor(n(e,t=>t.values[0]))} days`,min:Math.floor(n(e,t=>t.values[0])),max:f,color:""}];if(e.length===4||e.length===5){const t=d[0];t.max=Math.ceil(n(e[1].values)),t.label=`Below ${t.max} days`}if(e.length===4)d.splice(1,0,{label:`Below ${Math.ceil(n(e[2].values))} days`,min:Math.floor(e[2].values[0]),max:Math.ceil(n(e[2].values)),color:""});else if(e.length===5)d.splice(1,0,{label:`${Math.floor(e[2].values[0])} to ${Math.ceil(n(e[3].values))} days`,min:Math.floor(e[2].values[0]),max:Math.ceil(n(e[3].values)),color:""});else{const t=e.length/3,i=d[0];i.max=Math.ceil(n(e[Math.ceil(t-1)].values)),i.label=`Below ${i.max} days`;const u=Math.ceil(t),y=Math.floor(t),o={label:"",min:Math.floor(e[u].values[0]),max:Math.ceil(n(e[u+y].values)),color:""};o.label=`${o.min} to ${o.max} days`,d.splice(1,0,o);const h=n(d);h.min=Math.floor(e[u+y+1].values[0]),h.label=`Above ${h.min} days`}return d}const z=U.filter(c=>c.field!=="state"&&c.field!=="closed");function ee({forPrint:c}){const{data:f,options:p,metrics:e,isLoading:d,prDetails:t}=Y(),[i,u]=A.useState(null),y=({row:o})=>u(o);return r.jsxs("div",{children:[!c&&r.jsx(V,{title:"Pull Request Aging"}),r.jsxs("div",{className:"flex flex-col gap-4",children:[r.jsx(X,{data:f,options:p,metrics:e,isLoading:d}),r.jsx(E,{isLoading:d,containerClassName:"max-h-[80vh]",columns:z,rows:t,noRowsMessage:"No data found",totalRows:t.length,pagination:!1,onRowClick:y}),!!i&&r.jsx(L,{className:"mt-6",pr:i.pr,url:i.url})]})]})}export{ee as default};
