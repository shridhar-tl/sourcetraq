import{k as O,W as m,e as Z,P as M}from"../index.BzN25hFh.js";import{t as n,J as T,U as C}from"./chart-options-DtC3Yyrp.js";function V(e,i){const y=Object.keys(e||{});return y.length?y.filter(l=>e[l].prList.length).map(l=>{const r=e[l],d=i==null?void 0:i[l],D=(r==null?void 0:r.commits)??[],h=(d==null?void 0:d.commits)??[],o=(r==null?void 0:r.prList)??[],A=(d==null?void 0:d.prList)??[],x=D.length,f=h.length,u=x-f,P=f>0?u/f*100:100,v=o.length,k=A.length,a=v-k,p=k>0?a/k*100:100,F=o.filter(s=>s.state==="MERGED").length,R=o.filter(s=>s.state==="DECLINED").length,I=A.filter(s=>s.state==="DECLINED").length,t=R-I,c=I>0?t/I*100:100,w=[],E=[],j=[],U=[],Y=[],G=[],L=[],_=[];o.forEach(s=>{if(s.closedDate){const b=s.createdDate instanceof Date?s.createdDate:new Date(s.createdDate),B=s.closedDate instanceof Date?s.closedDate:new Date(s.closedDate);w.push(O(B,b))}const{firstCommitDate:H,createdDate:Q,firstActivityDate:J,approveDate:W}=s.properties.cycleTime;if(E.push(O(new Date(Q),new Date(H))),s.state==="MERGED"){const b=s.createdDate instanceof Date?s.createdDate:new Date(s.createdDate),B=s.closedDate instanceof Date?s.closedDate:new Date(s.closedDate);j.push(O(B,b))}if(W){const b=s.createdDate instanceof Date?s.createdDate:new Date(s.createdDate);U.push(O(new Date(W),b))}if(J){const b=s.createdDate instanceof Date?s.createdDate:new Date(s.createdDate);_.push(O(new Date(J),b))}const q=s.reviewers??[];Y.push(q.length),G.push(q.filter(b=>b.approved===!0).length),L.push(s.properties.commentCount)});const z=A.map(s=>s.properties.commentCount)??[],N=m(z);return{user:r.user,totalCommits:x,commitDelta:{diff:n(u),percent:n(P)},totalPRs:v,prDelta:{diff:n(a),percent:n(p)},mergedPRs:F,declinedPRs:R,declinedDelta:{diff:n(t),percent:n(c)},avgPROpenDays:n(m(w)),avgDaysFirstCommitToPR:n(m(E)),avgDaysPRToMerge:n(m(j)),avgDaysPRToApproval:n(m(U)),avgReviewers:n(m(Y)),avgReviewersApproved:n(m(G)),avgComments:n(m(L)),commentDelta:{diff:n(m(L)-N),percent:N>0?n((m(L)-N)/N*100):100},avgDaysFirstActivity:n(m(_))}}):[]}function S(e){if(!e||e.length===0)return{data:{labels:[],datasets:[]},options:T(C())};e=Z(e.filter(o=>o.totalCommits),o=>o.totalCommits).slice(0,15);const i=e.map(o=>o.totalCommits),y=e.map(o=>o.user),g=y.map(o=>o.displayName||o.name),l=M(i)||15,r=i.length<5?80:void 0,D={labels:g,datasets:[{label:"Commits",data:i,backgroundColor:"#4CAF50",type:"bar",stack:"stack1",borderRadius:2,barThickness:r,yAxisID:"y"}]},h=T({...C(),scales:{x:{stacked:!0,ticks:{display:!1},afterFit:o=>o.height=50},y:{stacked:!0,beginAtZero:!0,min:0,max:l}},plugins:{legend:{display:!1}},users:y});return{data:D,options:h}}function ee(e,i,y,g,l){if(!e||e.length===0)return{data:{labels:[],datasets:[]},options:T(C())};e=Z(e.filter(t=>t.totalPRs),t=>t.totalPRs).slice(0,l);const r=e.map(t=>t.mergedPR),d=e.map(t=>t.openPR),D=e.map(t=>t.declinedPR),h=e.map(t=>t.unknownPR),o=e.map(t=>t.user),A=o.map(t=>t.displayName||t.name),x=h.some(t=>t>0),f=V(i,y).reduce((t,c)=>(t[c.user.name]=c,t),{}),u=e.map(t=>{var c;return((c=f[t.user.name])==null?void 0:c.avgDaysPRToMerge)??0}),P=e.map(t=>{var c;return((c=f[t.user.name])==null?void 0:c.avgPROpenDays)??0}),v=e.map(t=>{var c;return((c=f[t.user.name])==null?void 0:c.avgDaysPRToApproval)??0}),k=M(e.map(t=>t.totalPRs))||15,a=M(P)||15,p=o.length<5?80:void 0,F=[{label:"Merged",data:r,backgroundColor:"#4CAF50",type:"bar",stack:"stack1",borderRadius:2,barThickness:p,yAxisID:"y"},{label:"Open",data:d,backgroundColor:"#FFD54F",type:"bar",stack:"stack1",borderRadius:2,barThickness:p,yAxisID:"y"},{label:"Declined",data:D,backgroundColor:"#F44336",type:"bar",stack:"stack1",borderRadius:2,barThickness:p,yAxisID:"y"},x&&{label:"Unknown",data:h,backgroundColor:"#9E9E9E",type:"bar",stack:"stack1",borderRadius:2,barThickness:p,yAxisID:"y"},{label:"Age",data:P,borderColor:"#FF9800",backgroundColor:"rgba(255,152,0,0.5)",type:"line",fill:!1,yAxisID:"y1"},{label:"Approval Days",data:v,borderColor:"#F44336",backgroundColor:"rgba(244,67,54,0.5)",type:"line",fill:!1,yAxisID:"y1"},{label:"Cycle Time",data:u,borderColor:"#2196F3",backgroundColor:"rgba(33,150,243,0.5)",type:"line",fill:!1,yAxisID:"y1"}].filter(Boolean),R={labels:A,datasets:F},I=T({...C(),onClick:(t,c)=>{var E;const w=(E=c==null?void 0:c[0])==null?void 0:E.index;w>=0&&(g==null||g(o[w]))},users:o,scales:{x:{stacked:!0,ticks:{display:!1},afterFit:t=>t.height=50},y:{stacked:!0,beginAtZero:!0,min:0,max:k},y1:{position:"right",beginAtZero:!0,min:0,max:a,grid:{drawOnChartArea:!1}}}});return{data:R,options:I}}function ae(e,i,y){if(!(e!=null&&e.length))return{data:{labels:[],datasets:[]},options:T(C())};e=Z(e,a=>a.totalApproved).slice(0,y);const g=e.map(a=>a.totalApproved),l=e.map(a=>a.totalReviewed),r=e.map(a=>a.totalRejected),d=e.map(a=>a.remainingPRCount),D=e.map(a=>a.user),h=D.map(a=>a.displayName||a.name),o=e.map(a=>a.cycleTime),A=e.map(a=>a.averageAge),x=M(e,a=>a.totalPRCount),f=Math.ceil(M(A)||15),u=D.length<5?80:void 0,P=[g.some(a=>a>0)&&{label:"Approved",data:g,backgroundColor:"#4CAF50",type:"bar",stack:"stack1",borderRadius:2,barThickness:u,yAxisID:"y"},l.some(a=>a>0)&&{label:"Reviewed",data:l,backgroundColor:"#FFD54F",type:"bar",stack:"stack1",borderRadius:2,barThickness:u,yAxisID:"y"},r.some(a=>a>0)&&{label:"Rejected",data:r,backgroundColor:"#F44336",type:"bar",stack:"stack1",borderRadius:2,barThickness:u,yAxisID:"y"},d.some(a=>a>0)&&{label:"Not Reviewed",data:d,backgroundColor:"#FF8A80",type:"bar",stack:"stack1",borderRadius:2,barThickness:u,yAxisID:"y"},{label:"Age",data:A,borderColor:"#FFB300",backgroundColor:"rgba(255, 179, 0, 0.4)",type:"line",fill:!1,yAxisID:"y1"},{label:"Cycle Time",data:o,borderColor:"#2196F3",backgroundColor:"rgba(33,150,243,0.5)",type:"line",fill:!1,yAxisID:"y1"}].filter(Boolean),v={labels:h,datasets:P},k=T({...C(),onClick:(a,p)=>{var R;const F=(R=p==null?void 0:p[0])==null?void 0:R.index;F>=0&&(i==null||i(D[F]))},scales:{x:{stacked:!0,ticks:{display:!1},afterFit:a=>a.height=50},y:{stacked:!0,beginAtZero:!0,min:0,max:x},y1:{position:"right",beginAtZero:!0,min:0,max:f,grid:{drawOnChartArea:!1}}},users:D});return{data:v,options:k}}export{ee as a,ae as b,V as c,S as g};
